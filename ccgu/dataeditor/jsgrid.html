<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Data Editor (jsGrid)</title>
	<link href="css/default.css" rel="stylesheet" />
	<link type="text/css" rel="stylesheet" href="js/jsgrid/jsgrid.min.css" />
        <link type="text/css" rel="stylesheet" href="js/jsgrid/jsgrid-theme.min.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script type="text/javascript" src="js/PlayerIOClient.development.js"></script>    
        <script type="text/javascript" src="js/jsgrid/jsgrid.min.js"></script>
  
	<script type="text/javascript">

		var global = {
			connection: null,
			users: {}
		}
		
		var cards = []

		function start() {

			console.log("Ready");

			var username = document.getElementById("namepicker").value
			document.getElementById("messages").style.display = "block"
			document.getElementById("input").style.display = "none"
			document.getElementById("users").style.display = "none"
			document.getElementById("pickname").style.display = "none"

			// connect to PlayerIO
			PlayerIO.authenticate("ccgu-sq4wkgjipkyjyjmfoi4kq", "test", { userId: username }, {}, function (client) {
				addChatLine('notice', '', 'connected to PlayerIO')
				log();

				client.bigDB.load("Development", "Data", function (dbo) {
					if (dbo == null)
						return;

					log(dbo.DevDecks);
					log();
					log(dbo.CardModels);
					log();
					log(dbo.CardTags);
					log();
					
					cards = JSON.parse( dbo.CardModels );
					
					initGrid();

				}, callbackError)
			})
		}

		function callbackError(error) { addChatLine("error", '', "ERROR: " + error.code + ": " + error.message) }

		function log(msg = '\n') { addChatLine("message", '', msg) }

		function addChatLine(className, source, text) {
			var el = document.createElement('div')
			el.setAttribute('class', className)
			el.innerHTML = '<b></b><span></span>'
			el.getElementsByTagName('b')[0].innerText = source ? source + ': ' : ''
			el.getElementsByTagName('span')[0].innerText = text
			var s = document.getElementById("scrollbox")
			s.appendChild(el)
			el.scrollIntoView()
		}

	</script>
  
  
</head>
<body>
  <div>Test</div>
	<pre/>
  <div id="jsGrid"></div>
	<pre/>
	<pre/>
	<pre/>
  
	<div id="messages">
		<div id="scrollbox">
		</div>
	</div>
	<div id="input">
		<input type="text" onkeypress="handleKeyPress(event)">
	</div>
	<div id="users">
	</div>
	<div id="pickname">
		<span>
			<h1>Pick Name:</h1>
			<input value="Unnamed" id="namepicker">
			<button onclick="start()">Start</button>
		</span>
	</div>

	<script type="text/javascript">start()</script>

  <script> 
    var countries = [
        { Name: "", Id: 0 },
        { Name: "United States", Id: 1 },
        { Name: "Canada", Id: 2 },
        { Name: "United Kingdom", Id: 3 }
    ]; 			
    function initGrid() {
	    $("#jsGrid").jsGrid({
		width: "100%",
		height: "400px",

		inserting: true,
		editing: true,
		sorting: true,
		paging: true,

		data: cards,

		fields: [
		    { name: "ID", type: "number", width: 15, validate: "required" },
		    { name: "Char", type: "text", width: 10 },
		    { name: "Type", type: "number", width: 30 },
		    { name: "Slug", type: "text", width: 30 },
		    { name: "Description", type: "text", width: 500 },
		    { name: "Name", type: "text", width: 40 },
		    { name: "Priority", type: "number", width: 10 },
		    { name: "Status", type: "number", width: 10 },
		    //{ name: "Country", type: "select", items: countries, valueField: "Id", textField: "Name" },
		    //{ name: "Married", type: "checkbox", title: "Is Married", sorting: false },
		    { type: "control" }
		]
	    });
    }
</script>
  
  
</body>
</html>
